<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Heera & Nabaraj Display</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        .user-card { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .vendor { border-left: 5px solid #ff9800; }
        .user { border-left: 5px solid #2196f3; }
        .admin { border-left: 5px solid #f44336; }
    </style>
</head>
<body>
    <h1>üß™ Test Heera & Nabaraj Display in Admin Dashboard</h1>
    <p>This page tests whether Heera and Nabaraj vendors are properly showing up in the admin dashboard.</p>

    <div class="section">
        <h2>üë• Current Users in System</h2>
        <button onclick="showAllUsers()">Show All Users</button>
        <button onclick="addHeeraNabaraj()">Add Heera & Nabaraj</button>
        <div id="usersDisplay"></div>
    </div>

    <div class="section">
        <h2>üè™ Vendor Status</h2>
        <button onclick="showVendorStatus()">Show Vendor Status</button>
        <button onclick="addTestProducts()">Add Test Products</button>
        <div id="vendorStatus"></div>
    </div>

    <div class="section">
        <h2>üîç Admin Dashboard Simulation</h2>
        <button onclick="simulateAdminDashboard()">Simulate Admin Dashboard View</button>
        <div id="adminSimulation"></div>
    </div>

    <div class="section">
        <h2>üõ†Ô∏è Debug Tools</h2>
        <button onclick="clearAllData()">Clear All Data</button>
        <button onclick="resetToDefaults()">Reset to Defaults</button>
        <div id="debugResults"></div>
    </div>

    <script>
        function showAllUsers() {
            const display = document.getElementById('usersDisplay');
            const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
            
            let html = '<h3>üë• All Users in System:</h3>';
            
            if (allUsers.length === 0) {
                html += '<p class="warning">No users found in system.</p>';
            } else {
                allUsers.forEach((user, index) => {
                    const roleClass = user.role === 'VENDOR' ? 'vendor' : 
                                    user.role === 'ADMIN' ? 'admin' : 'user';
                    
                    html += `
                        <div class="user-card ${roleClass}">
                            <h4>${user.name} (${user.email})</h4>
                            <p><strong>Role:</strong> ${user.role}</p>
                            <p><strong>Connected:</strong> ${user.isConnected ? '‚úÖ Yes' : '‚ùå No'}</p>
                            <p><strong>Products:</strong> ${user.productCount || 0}</p>
                            <p><strong>Business:</strong> ${user.businessName || 'N/A'}</p>
                            <p><strong>Created:</strong> ${user.createdAt ? new Date(user.createdAt).toLocaleString() : 'Unknown'}</p>
                            <p><strong>Last Login:</strong> ${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never'}</p>
                            <p><strong>Activity:</strong> ${user.lastActivity || 'Unknown'}</p>
                        </div>
                    `;
                });
            }
            
            display.innerHTML = html;
        }

        function addHeeraNabaraj() {
            const display = document.getElementById('usersDisplay');
            const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
            
            // Check if Heera and Nabaraj already exist
            const heeraExists = allUsers.find(u => u.email === 'heera@test.com');
            const nabarajExists = allUsers.find(u => u.email === 'nabaraj@test.com');
            
            let addedCount = 0;
            
            if (!heeraExists) {
                const heera = {
                    id: Date.now() + 1,
                    name: 'Heera',
                    email: 'heera@test.com',
                    role: 'VENDOR',
                    phone: '987-654-3210',
                    address: 'Kathmandu, Nepal',
                    businessName: 'Heera Restaurant',
                    businessType: 'Restaurant',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    isConnected: false,
                    vendorProducts: [],
                    productCount: 0,
                    lastActivity: 'No products yet'
                };
                allUsers.push(heera);
                addedCount++;
            }
            
            if (!nabarajExists) {
                const nabaraj = {
                    id: Date.now() + 2,
                    name: 'Nabaraj',
                    email: 'nabaraj@test.com',
                    role: 'VENDOR',
                    phone: '987-654-3211',
                    address: 'Pokhara, Nepal',
                    businessName: 'Nabaraj Restaurant',
                    businessType: 'Restaurant',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    isConnected: false,
                    vendorProducts: [],
                    productCount: 0,
                    lastActivity: 'No products yet'
                };
                allUsers.push(nabaraj);
                addedCount++;
            }
            
            localStorage.setItem('allUsers', JSON.stringify(allUsers));
            
            display.innerHTML = `<p class="success">‚úÖ Added ${addedCount} vendors to system (Heera & Nabaraj)</p>`;
            showAllUsers();
        }

        function showVendorStatus() {
            const status = document.getElementById('vendorStatus');
            const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
            const allVendorProducts = JSON.parse(localStorage.getItem('allVendorProducts') || '{}');
            
            const vendors = allUsers.filter(u => u.role === 'VENDOR');
            
            let html = '<h3>üè™ Vendor Status:</h3>';
            
            if (vendors.length === 0) {
                html += '<p class="warning">No vendors found in system.</p>';
            } else {
                vendors.forEach(vendor => {
                    const vendorKey = `vendor_${vendor.id}`;
                    const products = allVendorProducts[vendorKey] || [];
                    
                    html += `
                        <div class="user-card vendor">
                            <h4>${vendor.name} - ${vendor.businessName}</h4>
                            <p><strong>Email:</strong> ${vendor.email}</p>
                            <p><strong>Connected:</strong> ${vendor.isConnected ? '‚úÖ Yes' : '‚ùå No'}</p>
                            <p><strong>Products in localStorage:</strong> ${products.length}</p>
                            <p><strong>Product Count (user object):</strong> ${vendor.productCount || 0}</p>
                            <p><strong>Vendor Key:</strong> ${vendorKey}</p>
                            <p><strong>Status:</strong> ${vendor.lastActivity || 'Unknown'}</p>
                        </div>
                    `;
                });
            }
            
            status.innerHTML = html;
        }

        function addTestProducts() {
            const status = document.getElementById('vendorStatus');
            const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
            const allVendorProducts = JSON.parse(localStorage.getItem('allVendorProducts') || '{}');
            
            const vendors = allUsers.filter(u => u.role === 'VENDOR');
            
            let addedProducts = 0;
            
            vendors.forEach(vendor => {
                const vendorKey = `vendor_${vendor.id}`;
                const testProducts = [
                    {
                        id: Date.now() + addedProducts,
                        name: `${vendor.businessName} - Momo`,
                        price: 150,
                        category: 'Food',
                        vendor: vendor.businessName,
                        vendorId: vendor.id,
                        description: 'Delicious momo from ' + vendor.businessName,
                        image: 'momo.jpg',
                        rating: 4.5,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: Date.now() + addedProducts + 1,
                        name: `${vendor.businessName} - Thali`,
                        price: 250,
                        category: 'Food',
                        vendor: vendor.businessName,
                        vendorId: vendor.id,
                        description: 'Complete thali from ' + vendor.businessName,
                        image: 'thali.jpg',
                        rating: 4.8,
                        createdAt: new Date().toISOString()
                    }
                ];
                
                allVendorProducts[vendorKey] = testProducts;
                addedProducts += testProducts.length;
                
                // Update vendor connection status
                const vendorIndex = allUsers.findIndex(u => u.id === vendor.id);
                if (vendorIndex !== -1) {
                    allUsers[vendorIndex].isConnected = true;
                    allUsers[vendorIndex].vendorProducts = testProducts;
                    allUsers[vendorIndex].productCount = testProducts.length;
                    allUsers[vendorIndex].lastActivity = 'Active';
                }
            });
            
            localStorage.setItem('allVendorProducts', JSON.stringify(allVendorProducts));
            localStorage.setItem('allUsers', JSON.stringify(allUsers));
            
            status.innerHTML = `<p class="success">‚úÖ Added ${addedProducts} test products to vendors</p>`;
            showVendorStatus();
        }

        function simulateAdminDashboard() {
            const simulation = document.getElementById('adminSimulation');
            const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
            const allVendorProducts = JSON.parse(localStorage.getItem('allVendorProducts') || '{}');
            
            // Simulate the admin dashboard logic
            const registeredVendors = allUsers.filter(user => user.role === 'VENDOR');
            const allProducts = [];
            Object.keys(allVendorProducts).forEach(vendorKey => {
                if (allVendorProducts[vendorKey]) {
                    allProducts.push(...allVendorProducts[vendorKey]);
                }
            });
            
            const allVendorsList = [];
            registeredVendors.forEach(vendor => {
                const vendorName = vendor.businessName || vendor.shopName || vendor.name;
                const vendorProducts = allProducts.filter(p => p.vendor === vendorName);
                
                allVendorsList.push({
                    id: vendor.id,
                    name: vendorName,
                    email: vendor.email || 'N/A',
                    phone: vendor.phone || 'N/A',
                    businessType: vendor.businessType || 'N/A',
                    address: vendor.address || 'N/A',
                    registeredAt: vendor.createdAt || 'N/A',
                    isRegistered: true,
                    isConnected: vendorProducts.length > 0,
                    productCount: vendorProducts.length,
                    vendorId: vendor.id
                });
            });
            
            let html = '<h3>üîç Admin Dashboard Simulation:</h3>';
            html += `<p><strong>Total Users:</strong> ${allUsers.length}</p>`;
            html += `<p><strong>Total Vendors:</strong> ${allVendorsList.length}</p>`;
            html += `<p><strong>Total Products:</strong> ${allProducts.length}</p>`;
            
            html += '<h4>üë• Users that should appear in Admin Dashboard:</h4>';
            allUsers.forEach(user => {
                html += `
                    <div class="user-card ${user.role === 'VENDOR' ? 'vendor' : user.role === 'ADMIN' ? 'admin' : 'user'}">
                        <strong>${user.name}</strong> (${user.role}) - ${user.isConnected ? 'Connected' : 'Disconnected'}
                    </div>
                `;
            });
            
            html += '<h4>üè™ Vendors that should appear in Admin Dashboard:</h4>';
            allVendorsList.forEach(vendor => {
                html += `
                    <div class="user-card vendor">
                        <strong>${vendor.name}</strong> - ${vendor.productCount} products - ${vendor.isConnected ? 'Connected' : 'Disconnected'}
                    </div>
                `;
            });
            
            simulation.innerHTML = html;
        }

        function clearAllData() {
            const debug = document.getElementById('debugResults');
            localStorage.removeItem('allUsers');
            localStorage.removeItem('allVendorProducts');
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            debug.innerHTML = '<p class="success">‚úÖ All localStorage data cleared</p>';
            showAllUsers();
            showVendorStatus();
        }

        function resetToDefaults() {
            const debug = document.getElementById('debugResults');
            
            const defaultUsers = [
                {
                    id: 1,
                    name: 'Admin User',
                    email: 'admin@test.com',
                    role: 'ADMIN',
                    phone: '123-456-7890',
                    address: '123 Admin St',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    isConnected: true,
                    vendorProducts: [],
                    productCount: 0,
                    lastActivity: 'Managing System'
                },
                {
                    id: 2,
                    name: 'Heera',
                    email: 'heera@test.com',
                    role: 'VENDOR',
                    phone: '987-654-3210',
                    address: 'Kathmandu, Nepal',
                    businessName: 'Heera Restaurant',
                    businessType: 'Restaurant',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    isConnected: false,
                    vendorProducts: [],
                    productCount: 0,
                    lastActivity: 'No products yet'
                },
                {
                    id: 3,
                    name: 'Nabaraj',
                    email: 'nabaraj@test.com',
                    role: 'VENDOR',
                    phone: '987-654-3211',
                    address: 'Pokhara, Nepal',
                    businessName: 'Nabaraj Restaurant',
                    businessType: 'Restaurant',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    isConnected: false,
                    vendorProducts: [],
                    productCount: 0,
                    lastActivity: 'No products yet'
                },
                {
                    id: 4,
                    name: 'Test User',
                    email: 'user@test.com',
                    role: 'USER',
                    phone: '123-456-7891',
                    address: '123 User St',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    isConnected: true,
                    vendorProducts: [],
                    productCount: 0,
                    lastActivity: 'Active'
                }
            ];
            
            localStorage.setItem('allUsers', JSON.stringify(defaultUsers));
            localStorage.setItem('allVendorProducts', JSON.stringify({}));
            
            debug.innerHTML = '<p class="success">‚úÖ Reset to default users including Heera & Nabaraj</p>';
            showAllUsers();
            showVendorStatus();
        }

        // Auto-load on page start
        window.onload = function() {
            showAllUsers();
            showVendorStatus();
        };
    </script>
</body>
</html>
